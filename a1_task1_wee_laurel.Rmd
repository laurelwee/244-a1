---
title: 'Task 1: Data wrangling & visualization (Sierra amphibians)'
author: "Laurel Wee"
date: "1/22/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
library(readxl)
library(patchwork)
library(lubridate)
```

```{r, include=FALSE, warning=FALSE}
# Read in '.xlsx' data using 'read_excel'
amphibians <- read_excel(here("data","sierra_amphibians.xlsx"))

# Part 1
# Make a subset of data to include only mountain yellow-legged frogs. Exclude 'EggMass' life stage. Select life stage, date, and amphibian_number

ramu_amphibians <- amphibians %>% 
  filter(amphibian_species == "RAMU") %>% 
  mutate(date = ymd(survey_date)) %>% # Put 'survey_date' as date 
  select(amphibian_life_stage, date, amphibian_number) %>% 
  filter(amphibian_life_stage %in% c("Adult","SubAdult","Tadpole")) %>% 
  mutate(year = year(date)) # Make a new column that includes the year
```


```{r, include=FALSE}
# Make a subset that is the counts of above df by 'amphibian_life_stage' and year and includes the 'amphibian_number' 
ramu_count <- ramu_amphibians %>% 
  group_by(year) %>% 
  count(amphibian_life_stage, wt = amphibian_number) %>% 
  rename("count"=n)
```

```{r, ramu_time_plot, include=FALSE, warning=FALSE}
ramu_time_plot <- ggplot(data = ramu_count, 
       aes(year, y= count, fill= amphibian_life_stage))+ 
  geom_col(color= "black", 
                 bins = 30, alpha = .75)+
  facet_wrap(~amphibian_life_stage)+
  theme_minimal()+
  theme(legend.position = "none")+
  labs(x= "Year", y= "Total count", title = "Mountain Yellow-legged frogs (Ramu) counts from  1995-2002",subtitle= " Shown for Adult, Subadult, and Tadpool life stages [WEE]")
  
```


```{r, include= FALSE}
ramu_top5 <- amphibians %>% 
  filter(amphibian_species == "RAMU") %>% 
  mutate(date = ymd(survey_date)) %>% # Put 'survey_date' as date 
  mutate(lake = paste0("Lake ", lake_id)) %>% 
  select(amphibian_life_stage, date, lake, amphibian_number) %>% 
  filter(amphibian_life_stage %in% c("Adult","SubAdult")) %>% 
  mutate(year = year(date)) %>% #Make a new column that includes the year
  group_by(lake) %>% 
  count(wt = amphibian_number) %>% 
  rename("count"=n) %>% 
  ungroup(lake) %>% 
  arrange(-count) %>% 
  slice_max(count, n=5)
```

```{r, ramu_top5_plot, include=FALSE}
ramu_top5_plot <- ggplot(data = ramu_top5, 
       aes(lake, count, fill=lake))+
  geom_col()+
  theme_minimal()+
  theme(legend.position = 'none')+
  labs(x= "Lake", y= "Total count", title = "Mountain Yellow-legged (Ramu) frog counts", subtitle = "Top 5 lakes with largest Ramu counts from 1995-2002 [WEE]")
```

```{r, ramu_combined_plot, echo=FALSE, fig.cap= "Figure: Endangered Mountain Yellow-legged frogs (Rana muscosa) were surveyed from 1995-2002 in the Sierra Lakes. Mountain Yellow-legged frogs are shown to decrease in numbers as they reach adult stage of life as compared to the the tadpool stage (top plot). The five Sierran lakes with the most adult and subadult Mountain Yellow-legged frogs surveyed are, in descending order, Lake 50183, Lake 10223, Lake 10329, Lake 20196 and Lake 10225 (bottom plot)."}

ramu_combined_plot <- ramu_time_plot/ramu_top5_plot	# Part 3 combine the plots made in Part 1 and 2

ramu_combined_plot + plot_annotation(title= "Mountain Yellow-legged frogs (Ramu) counts from  1995-2002 [WEE]")
```



